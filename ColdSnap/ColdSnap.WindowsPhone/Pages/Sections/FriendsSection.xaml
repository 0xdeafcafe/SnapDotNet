<controls:SnazzyHubSection
	x:Class="ColdSnap.Pages.Sections.FriendsSection"
	x:Uid="FriendsSection"
	
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:controls="using:ColdSnap.Controls"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:sections="using:ColdSnap.ViewModels.Sections"
	xmlns:sdn="using:SnapDotNet"
	xmlns:customTypes="using:SnapDotNet.Utilities.CustomTypes"
	xmlns:converters="using:ColdSnap.Converters"
	xmlns:controls1="using:WinRTXamlToolkit.Controls"
	xmlns:friends="using:ColdSnap.Converters.Sections.Friends"
	xmlns:friends1="using:ColdSnap.Selectors.Sections.Friends"
	xmlns:test="using:ColdSnap.Controls.Test"
	mc:Ignorable="d"

	AccentColor="#FF9b55a0"
	Header="my friends">
	<controls:SnazzyHubSection.LeftHeaderDataTemplate>
		<DataTemplate>
			<Grid>
				<Button Style="{StaticResource FluidButtonStyle}"
						HorizontalAlignment="Left" VerticalAlignment="Bottom"
						Tapped="GoToCameraButton_Tapped"
						Margin="0,0,0,-3">
					<Grid Width="60" Height="48" RenderTransformOrigin="0.5,0.5">
						<Grid.RenderTransform>
							<CompositeTransform ScaleX="0.5" ScaleY="0.5"/>
						</Grid.RenderTransform>
						<Border Width="60" Height="46" Background="White" CornerRadius="4">
							<Ellipse Stroke="#FF9b55a0" StrokeThickness="5"
									 Width="24" Height="24" 
									 VerticalAlignment="Center" HorizontalAlignment="Center"/>
						</Border>
					</Grid>
				</Button>
			</Grid>
		</DataTemplate>
	</controls:SnazzyHubSection.LeftHeaderDataTemplate>
	<controls:SnazzyHubSection.RightHeaderDataTemplate>
		<DataTemplate>
			<Grid>
				<Button Style="{StaticResource FluidButtonStyle}"
						HorizontalAlignment="Right" VerticalAlignment="Bottom"
						Tapped="AddFriendsButton_Tapped"
						Margin="0,0,-5,0">
					<Grid Width="52" Height="48" RenderTransformOrigin="0.5,0.5">
						<Grid.RenderTransform>
							<CompositeTransform ScaleX="0.6" ScaleY="0.6"/>
						</Grid.RenderTransform>
						<Border Height="14" Width="38" Background="White" CornerRadius="15,15,0,0" 
								VerticalAlignment="Bottom" HorizontalAlignment="Left"/>
						<Ellipse Width="24" Height="24" Fill="White" Margin="7,9,0,0"
								 VerticalAlignment="Top" HorizontalAlignment="Left"/>

						<Path StrokeThickness="6" Stroke="White"
							  Margin="0,3,0,0"
							  StrokeDashCap="Round" StrokeEndLineCap="Round"
							  StrokeStartLineCap="Round" StrokeLineJoin="Round"
							  VerticalAlignment="Top" HorizontalAlignment="Right"
							  Data="M 0,9 L 9,9 9,0 9,9 18,9 9,9 9,18 9,9" RenderTransformOrigin="0.5,0.5" >
							<Path.RenderTransform>
								<CompositeTransform ScaleX="0.7" ScaleY="0.7"/>
							</Path.RenderTransform>
						</Path>
					</Grid>
				</Button>
			</Grid>
		</DataTemplate>
	</controls:SnazzyHubSection.RightHeaderDataTemplate>

	<d:DesignProperties.DataContext>
		<sections:FriendsSectionViewModel/>
	</d:DesignProperties.DataContext>

	<controls:SnazzyHubSection.PrimaryCommands>
	</controls:SnazzyHubSection.PrimaryCommands>

	<controls:SnazzyHubSection.SecondaryCommands>
	</controls:SnazzyHubSection.SecondaryCommands>

	<DataTemplate>
		<Grid x:Name="grid">
			<Grid.Resources>
				<ResourceDictionary>
					<Style x:Key="EditAccountButtonStyle" TargetType="Button">
						<Setter Property="Background" Value="Transparent"/>
						<Setter Property="Padding" Value="0"/>
						<Setter Property="MinHeight" Value="0"/>
						<Setter Property="MinWidth" Value="0"/>
						<Setter Property="Template">
							<Setter.Value>
								<ControlTemplate TargetType="Button">
									<Grid x:Name="Grid" Background="Transparent">
										<VisualStateManager.VisualStateGroups>
											<VisualStateGroup x:Name="CommonStates">
												<VisualState x:Name="Normal"/>
												<VisualState x:Name="PointerOver"/>
												<VisualState x:Name="FluoutOpening">
													<Storyboard>
														<ColorAnimation Storyboard.TargetName="CentralEllipse" Storyboard.TargetProperty="Background" 
																Duration="0:0:0" To="#FF999999"/>
													</Storyboard>
												</VisualState>
												<VisualState x:Name="FluoutClosed">
													<Storyboard>
														<ColorAnimation Storyboard.TargetName="CentralEllipse" Storyboard.TargetProperty="Background" 
																Duration="0:0:0" To="#FFFFFFFF"/>
													</Storyboard>
												</VisualState>
												<VisualState x:Name="Pressed">
													<Storyboard>
														<!--<PointerDownThemeAnimation Storyboard.TargetName="Grid"/>-->
													</Storyboard>
												</VisualState>
											</VisualStateGroup>
										</VisualStateManager.VisualStateGroups>
										<Viewbox Width="25">
											<Grid>
												<Path Data="F 1 M 14.015,44.819 L 14.367,45.022 C 13.908,48.318 13.908,51.655 14.374,54.976 L 14.018,55.184 C 7.576,58.905 5.359,67.178 9.08,73.625 11.482,77.788 15.967,80.376 20.781,80.376 23.137,80.376 25.469,79.748 27.519,78.564 L 27.873,78.359 C 30.515,80.424 33.405,82.094 36.496,83.344 L 36.496,83.749 C 36.496,91.192 42.551,97.25 49.997,97.25 57.44,97.25 63.498,91.192 63.498,83.749 L 63.498,83.351 C 65.095,82.712 66.603,81.982 67.997,81.176 69.401,80.365 70.785,79.423 72.131,78.368 L 72.475,78.568 C 74.524,79.753 76.853,80.378 79.211,80.378 L 79.211,80.378 C 84.025,80.378 88.513,77.79 90.915,73.624 92.717,70.502 93.195,66.866 92.263,63.383 91.33,59.897 89.099,56.987 85.976,55.185 L 85.627,54.982 C 86.088,51.677 86.086,48.339 85.622,45.019 L 85.974,44.814 C 89.099,43.012 91.332,40.102 92.265,36.616 93.201,33.135 92.722,29.497 90.917,26.377 88.513,22.212 84.03,19.624 79.216,19.624 76.858,19.624 74.528,20.249 72.475,21.433 L 72.121,21.638 C 69.475,19.57 66.584,17.9 63.498,16.655 L 63.498,16.25 C 63.493,8.806 57.438,2.749 49.997,2.749 46.393,2.749 43,4.153 40.451,6.704 37.897,9.255 36.493,12.646 36.496,16.247 L 36.493,16.647 C 34.904,17.284 33.395,18.014 31.994,18.822 30.568,19.647 29.203,20.575 27.86,21.632 L 27.516,21.434 C 25.465,20.25 23.136,19.622 20.78,19.622 15.966,19.622 11.481,22.21 9.07401,26.375 5.353,32.827 7.571,41.099 14.015,44.819 Z" 
													  Fill="#FFAAAAAA"/>
												<Border x:Name="CentralEllipse" VerticalAlignment="Center" HorizontalAlignment="Center" 
														Width="30" Height="30" Background="#FFFFFFFF" CornerRadius="25"
														Margin="8,7,0,0" />
											</Grid>
										</Viewbox>
									</Grid>
								</ControlTemplate>
							</Setter.Value>
						</Setter>
					</Style>

					<converters:BooleanToVisibilityConverter x:Key="InvertedBooleanToVisibilityConverter" IsInverted="True" />
					<converters:NumberWithDelimiterConverter x:Key="NumberWithDelimiterConverter" />
					<converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
					<converters:BytesToBitmapImageConverter x:Key="BytesToBitmapImageConverter" />
					<friends:StoryAngleConverter x:Key="StoryAngleConverter" />

					<JumpListItemBackgroundConverter x:Key="BackgroundConverter"/>
					<JumpListItemForegroundConverter x:Key="ForegroundConverter"/>
					<CollectionViewSource x:Key="FriendGroups" IsSourceGrouped="True"
										  Source="{Binding Path=Account.SortedFriends}" />

					<DataTemplate x:Name="ItemTemplate">
						<Border d:DataContext="{d:DesignInstance Type=sdn:Friend}"
								Background="Transparent" BorderBrush="#FFf5f5f5" BorderThickness="0,0,0,1"
								MinHeight="62">
							<controls:ExpanderView HeaderText="{Binding Path=FriendlyName, FallbackValue='Alex Reed', UpdateSourceTrigger=PropertyChanged}"
												   SubHeaderText="{Binding Path=Name, FallbackValue='alexerax', UpdateSourceTrigger=PropertyChanged}"
												   ShowSubHeader="{Binding Path=HasDisplayName, UpdateSourceTrigger=PropertyChanged}"
												   Tag="{Binding Path=Name, UpdateSourceTrigger=PropertyChanged}"
												   HeaderHeight="60"
												   ContentHeight="105"
												   Expanded="ExpanderView_OnExpanded">
								<controls:ExpanderView.HeaderCoverContentTemplate>
									<DataTemplate>
										<Button Style="{StaticResource CleanButtonStyle}" 
												VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
												VerticalContentAlignment="Stretch"
												
												PointerEntered="UIElement_OnPointerEntered"
												PointerCaptureLost="UIElement_OnPointerCaptureLost">
											<!--<Grid Background="#4CFF0000" />-->
											<!-- Marks the clickable area - Debug Only -->
										</Button>
									</DataTemplate>
								</controls:ExpanderView.HeaderCoverContentTemplate>
								<controls:ExpanderView.AdditionalHeaderContentTemplate>
									<DataTemplate>
										<Grid VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,30,0">
											<Button Style="{StaticResource EditAccountButtonStyle}" Click="EditFriendButton_OnClick" />
										</Grid>
									</DataTemplate>
								</controls:ExpanderView.AdditionalHeaderContentTemplate>
								<controls:ExpanderView.PrimaryHeaderContentTemplate>
									<DataTemplate>
										<Grid>
											<ItemsControl ItemsSource="{Binding Path=Stories}">
												<ItemsControl.ItemsPanel>
													<ItemsPanelTemplate>
														<Grid/>
													</ItemsPanelTemplate>
												</ItemsControl.ItemsPanel>
												<ItemsControl.ItemTemplate>
													<DataTemplate>
														<controls1:PieSlice Radius="25" EndAngle="360" Margin="0,0,8,0"
																			StartAngle="{Binding Path=ExpiresAt, Converter={StaticResource StoryAngleConverter}}">
															<controls1:PieSlice.Fill>
																<ImageBrush Stretch="UniformToFill" 
																			ImageSource="{Binding Path=ThumbnailData, Converter={StaticResource BytesToBitmapImageConverter}}"/>
															</controls1:PieSlice.Fill>
														</controls1:PieSlice>
													</DataTemplate>
												</ItemsControl.ItemTemplate>
											</ItemsControl>
										</Grid>
									</DataTemplate>
								</controls:ExpanderView.PrimaryHeaderContentTemplate>
								<controls:ExpanderView.ExpandableContentTemplate>
									<DataTemplate>
										<Grid Background="#eeeeee">
											<StackPanel Margin="18,4,0,4">
												<TextBlock Foreground="#FF333333" FontSize="17">
													<Run x:Uid="FriendsScore" Text="Score:" />
													<Run Text="{Binding Path=Score, Converter={StaticResource NumberWithDelimiterConverter}}" />
												</TextBlock>
												<ItemsControl ItemsSource="{Binding Path=BestFriends}" Margin="0,2,0,4"
															  Visibility="{Binding Path=HasBestFriends, Converter={StaticResource BooleanToVisibilityConverter}}">
													<ItemsControl.ItemTemplate>
														<DataTemplate>
															<StackPanel Orientation="Horizontal">
																<Viewbox Height="15" Width="17" Margin="0,1,0,0" VerticalAlignment="Center">
																	<Path Fill="#FFFED41B" 
																		  Data="F1 M 145.637,174.227L 127.619,110.39L 180.809,70.7577L 114.528,68.1664L 93.2725,5.33333L 70.3262,67.569L 4,68.3681L 56.0988,109.423L 36.3629,172.75L 91.508,135.888L 145.637,174.227 Z"/>
																</Viewbox>
																<TextBlock Foreground="#333333" Text="{Binding}" Margin="6,0,0,0" FontSize="17" VerticalAlignment="Center" />
															</StackPanel>
														</DataTemplate>
													</ItemsControl.ItemTemplate>
												</ItemsControl>
												<TextBlock Foreground="#333333" Margin="0,2,0,0" FontSize="17"
														   Visibility="{Binding Path=HasBestFriends, Converter={StaticResource InvertedBooleanToVisibilityConverter}}">
													<Run x:Uid="FriendsNoBestFriends" Text="No Best Friends" />
													<Run Text="&#x1f622;" FontSize="24" />
												</TextBlock>
											</StackPanel>
										</Grid>
									</DataTemplate>
								</controls:ExpanderView.ExpandableContentTemplate>
							</controls:ExpanderView>
						</Border>
					</DataTemplate>
					<DataTemplate x:Name="GroupHeaderTemplate">
						<Grid d:DataContext="{d:DesignInstance Type=customTypes:FriendsKeyGroup}" Height="30">
							<Grid.Background>
								<SolidColorBrush Color="{Binding Path=BackgroundColour}" />
							</Grid.Background>

							<TextBlock FontWeight="Bold" Text="{Binding Path=FriendlyKey}"
									   Margin="17,0,0,0" FontSize="13" VerticalAlignment="Center" HorizontalAlignment="Left" 
									   FontFamily="Segoe WP">
								<TextBlock.Foreground>
									<SolidColorBrush Color="{Binding Path=ForegroundColour}" />
								</TextBlock.Foreground>
							</TextBlock>
						</Grid>
					</DataTemplate>
					<DataTemplate x:Name="JumpListTemplate">
						<Border Padding="5">
							<Border Background="{Binding Converter={StaticResource BackgroundConverter}}" 
									Width="82" Height="82" HorizontalAlignment="Left">

								<TextBlock Text="{Binding Path=Group.Key}" 
										   Foreground="{Binding Converter={StaticResource ForegroundConverter}}" 
										   FontSize="48" Padding="6" 
										   HorizontalAlignment="Left" VerticalAlignment="Center"/>
							</Border>
						</Border>
					</DataTemplate>
				</ResourceDictionary>
			</Grid.Resources>

			<ScrollViewer>
				<SemanticZoom>
					<SemanticZoom.ZoomedInView>
						<ListView x:Name="FriendsList" IsHoldingEnabled="False"
									  Loaded="FriendsList_OnLoaded"
									  ItemTemplate="{StaticResource ItemTemplate}"
									  ItemsSource="{Binding Source={StaticResource FriendGroups}}" 
									  IsSwipeEnabled="False" IsRightTapEnabled="False" IsDoubleTapEnabled="False">
							<ListView.ItemContainerStyle>
								<Style TargetType="ListViewItem" BasedOn="{StaticResource NoTiltListViewStyle}">
									<Setter Property="HorizontalContentAlignment" Value="Stretch" />
								</Style>
							</ListView.ItemContainerStyle>
							<ListView.Template>
								<ControlTemplate TargetType="ListView">
									<ScrollViewer>
										<Grid>
											<Grid.RowDefinitions>
												<RowDefinition Height="Auto" />
												<RowDefinition Height="*" />
											</Grid.RowDefinitions>

											<!-- This ma guy xox -->
											<StackPanel>
												<controls:ExpanderView HeaderText="{Binding Path=Account.Me.FriendlyName, FallbackValue='Alex Reed', UpdateSourceTrigger=PropertyChanged}"
																	   SubHeaderText="{Binding Path=Account.Me.Name, FallbackValue='alexerax', UpdateSourceTrigger=PropertyChanged}"
																	   ShowSubHeader="{Binding Path=Account.Me.HasDisplayName}"
																	   Tag="{Binding Path=Account.Me.Name, UpdateSourceTrigger=PropertyChanged}"
																	   HeaderHeight="60"
																	   ContentHeight="105"
																	   Expanded="UserStoryExpanderView_OnExpanded">
													<controls:ExpanderView.HeaderCoverContentTemplate>
														<DataTemplate>
															<Button Style="{StaticResource CleanButtonStyle}" 
																	VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
																	VerticalContentAlignment="Stretch"
												
																	PointerEntered="UIElement_OnPointerEntered"
																	PointerCaptureLost="UIElement_OnPointerCaptureLost">
																<!--<Grid Background="#4CFF0000" />-->
																<!-- Marks the clickable area - Debug Only -->
															</Button>
														</DataTemplate>
													</controls:ExpanderView.HeaderCoverContentTemplate>
													<controls:ExpanderView.AdditionalHeaderContentTemplate>
														<DataTemplate>
															<Grid VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,30,0">
																<Button Style="{StaticResource EditAccountButtonStyle}" Click="EditFriendButton_OnClick" />
															</Grid>
														</DataTemplate>
													</controls:ExpanderView.AdditionalHeaderContentTemplate>
													<controls:ExpanderView.PrimaryHeaderContentTemplate>
														<DataTemplate>
															<Grid>
																<ItemsControl ItemsSource="{Binding Path=Account.PersonalStories}">
																	<ItemsControl.ItemsPanel>
																		<ItemsPanelTemplate>
																			<Grid/>
																		</ItemsPanelTemplate>
																	</ItemsControl.ItemsPanel>
																	<ItemsControl.ItemTemplate>
																		<DataTemplate>
																			<controls1:PieSlice Radius="25" EndAngle="360" Margin="0,0,8,0"
																								StartAngle="{Binding Path=Story.ExpiresAt, Converter={StaticResource StoryAngleConverter}}">
																				<controls1:PieSlice.Fill>
																					<ImageBrush Stretch="UniformToFill" 
																								ImageSource="{Binding Path=Story.ThumbnailData, Converter={StaticResource BytesToBitmapImageConverter}}"/>
																				</controls1:PieSlice.Fill>
																			</controls1:PieSlice>
																		</DataTemplate>
																	</ItemsControl.ItemTemplate>
																</ItemsControl>
															</Grid>
														</DataTemplate>
													</controls:ExpanderView.PrimaryHeaderContentTemplate>
													<controls:ExpanderView.ExpandableContentTemplate>
														<DataTemplate>
															<Grid Background="#eeeeee">
																<TextBlock Foreground="#333333" Margin="0,2,0,0" FontSize="17">
																	<Run Text="TODO: this. " />
																	<Run Text="&#x1F61A;" FontSize="24" />
																</TextBlock>
															</Grid>
														</DataTemplate>
													</controls:ExpanderView.ExpandableContentTemplate>
												</controls:ExpanderView>
											</StackPanel>

											<ItemsPresenter Grid.Row="1" Margin="0,0,0,25" />
										</Grid>
									</ScrollViewer>
								</ControlTemplate>
							</ListView.Template>
							<ListView.GroupStyle>
								<GroupStyle HidesIfEmpty="True"
												HeaderTemplate="{StaticResource GroupHeaderTemplate}">
									<GroupStyle.HeaderContainerStyle>
										<Style TargetType="ListViewHeaderItem">
											<Setter Property="HorizontalContentAlignment" Value="Stretch" />
										</Style>
									</GroupStyle.HeaderContainerStyle>
								</GroupStyle>
							</ListView.GroupStyle>
						</ListView>
					</SemanticZoom.ZoomedInView>
					<SemanticZoom.ZoomedOutView>
						<GridView Background="#AAFFFFFF" 
									  ItemsSource="{Binding Source={StaticResource FriendGroups}, Path=CollectionGroups}"
									  ItemTemplate="{StaticResource JumpListTemplate}">
						</GridView>
					</SemanticZoom.ZoomedOutView>
				</SemanticZoom>
			</ScrollViewer>

			<!-- StoryOverlayGrid -->
			<Grid x:Name="StoryOverlayGrid" Margin="0,-80,0,0" Tapped="UIElement_OnTapped" 
				  IsHitTestVisible="True" Background="Transparent"
				  Visibility="{Binding Path=ActiveStory, Converter={StaticResource NullToVisibilityConverter}, FallbackValue=Collapsed}">
				<Grid.Resources>
					<DataTemplate x:Key="ImageMediaTemplate">
						<Image d:DataContext="{d:DesignInstance Type=sdn:Story}"
							   Source="{Binding Path=MediaData, Converter={StaticResource BytesToBitmapImageConverter}}" 
							   Stretch="Uniform" IsHitTestVisible="False" />
					</DataTemplate>
					<DataTemplate x:Key="VideoMediaTemplate">
						<Grid d:DataContext="{d:DesignInstance Type=sdn:Story}" Background="#FF000000">
							<ContentControl Content="{Binding Path=MediaElement}" />

							<Image d:DataContext="{d:DesignInstance Type=sdn:Story}"
								   Source="{Binding Path=MediaOverlayData, Converter={StaticResource BytesToBitmapImageConverter}}" 
								   Stretch="Uniform" IsHitTestVisible="False" />
						</Grid>
					</DataTemplate>

					<friends1:StoryMediaTypeSelector x:Key="StoryMediaTypeSelector" 
													 ImageDataTemplate="{StaticResource ImageMediaTemplate}"
													 VideoDataTemplate="{StaticResource VideoMediaTemplate}"/>
				</Grid.Resources>

				<ContentControl Content="{Binding Path=ActiveStory}"
								ContentTemplateSelector="{StaticResource StoryMediaTypeSelector}" />

				<!-- User Interface -->
				<Grid Width="55" Height="55" Margin="0,9,9,0"
					  VerticalAlignment="Top" HorizontalAlignment="Right">
					<Grid>
						<Ellipse Fill="#88000000" HorizontalAlignment="Center" VerticalAlignment="Center" Height="42" Width="42"/>
						<controls:CircularProgressBar HorizontalAlignment="Center" VerticalAlignment="Center" 
							Percentage="100"
							StrokeThickness="2" SegmentColor="#EE808080" Radius="21" />
						<controls:CircularProgressBar HorizontalAlignment="Center" VerticalAlignment="Center" 
							Percentage="{Binding ActiveStory.PercentageLeft, FallbackValue=80}" 
							StrokeThickness="2" SegmentColor="#FFFFFFFF" Radius="21" />
					</Grid>
					<TextBlock VerticalAlignment="Center" HorizontalAlignment="Center"
							   FontFamily="Segoe WP" FontWeight="SemiBold" FontSize="20" 
							   Text="{Binding Path=TotalSecondsRemaining, FallbackValue=''}"/> <!-- Margin="2,-2,0,0" -->
				</Grid>
			</Grid>
		</Grid>
	</DataTemplate>
</controls:SnazzyHubSection>
